<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Task Scheduler</title>
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css"/>
    <!-- DataTables Buttons & Excel Export CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.dataTables.min.css"/>
    
    <!-- Required JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/js/jquery.dataTables.min.js"></script>
    <!-- Excel Export Dependencies -->
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>
    
    <style>
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .controls {
            margin-bottom: 20px;
        }
        /* Style the export button to match the Set Start button */
        .dt-buttons {
            margin-bottom: 10px;
        }
        .dt-button {
            padding: 5px 10px;
            margin-right: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #f8f9fa;
            cursor: pointer;
        }
        .dt-button:hover {
            background-color: #e9ecef;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Task Scheduler</h1>
        <div class="controls">
            <input type="datetime-local" id="date-time-input" />
            <button id="transform-button">Set Start</button>
        </div>
        <table id="taskTable" class="display">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Start Display</th>
                    <th>Offset (min)</th>
                    <th>Description</th>
                </tr>
            </thead>
        </table>
    </div>

    <script>
        const tasks = [
            {
                id: 1,
                name: "Task 1",
                description: "First task",
                start_offset: "360"
            },
            {
                id: 2,
                name: "Task 2",
                description: "Second task",
                start_offset: "30"
            }
        ];

        function addOffset(dateTime, offsetMinutes) {
            const date = new Date(dateTime);
            const offset = parseInt(offsetMinutes, 10);
            date.setMinutes(date.getMinutes() + offset);
            
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            
            return `${year}-${month}-${day}T${hours}:${minutes}`;
        }

        $(document).ready(function() {
            // Initial table setup with export button
            let table = $('#taskTable').DataTable({
                data: tasks,
                dom: 'Bfrtip', // Add buttons to the DOM
                buttons: [
                    {
                        extend: 'excel',
                        text: 'Export to Excel',
                        title: 'Task Schedule',
                        filename: function() {
                            // Generate filename with current date
                            const now = new Date();
                            return `task_schedule_${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}`;
                        },
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4] // Export all columns
                        }
                    }
                ],
                columns: [
                    { data: 'id' },
                    { data: 'name' },
                    { 
                        data: null,
                        render: function(data, type, row) {
                            return ''; // Initially empty
                        }
                    },
                    { data: 'start_offset' },
                    { data: 'description' }
                ]
            });

            $('#transform-button').on('click', function() {
                const dateTime = $('#date-time-input').val();
                if (dateTime) {
                    table.destroy();
                    table = $('#taskTable').DataTable({
                        data: tasks,
                        dom: 'Bfrtip',
                        buttons: [
                            {
                                extend: 'excel',
                                text: 'Export to Excel',
                                title: 'Task Schedule',
                                filename: function() {
                                    const now = new Date();
                                    return `task_schedule_${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}`;
                                },
                                exportOptions: {
                                    columns: [0, 1, 2, 3, 4]
                                }
                            }
                        ],
                        columns: [
                            { data: 'id' },
                            { data: 'name' },
                            { 
                                data: null,
                                render: function(data, type, row) {
                                    return addOffset(dateTime, row.start_offset);
                                }
                            },
                            { data: 'start_offset' },
                            { data: 'description' }
                        ]
                    });
                }
            });
        });
    </script>
</body>
</html>
